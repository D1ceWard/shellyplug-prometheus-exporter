crystal_doc_search_index_callback({"repository_name":"shellyplug-prometheus-exporter","body":"","program":{"html_id":"shellyplug-prometheus-exporter/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"locations":[],"repository_name":"shellyplug-prometheus-exporter","program":true,"enum":false,"alias":false,"const":false,"types":[{"html_id":"shellyplug-prometheus-exporter/ShellyplugExporter","path":"ShellyplugExporter.html","kind":"module","full_name":"ShellyplugExporter","name":"ShellyplugExporter","abstract":false,"locations":[{"filename":"src/error.cr","line_number":1,"url":null},{"filename":"src/shellyplug_exporter/plug.cr","line_number":1,"url":null},{"filename":"src/shellyplug_exporter/server.cr","line_number":1,"url":null},{"filename":"src/version.cr","line_number":1,"url":null}],"repository_name":"shellyplug-prometheus-exporter","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"VERSION","name":"VERSION","value":"\"0.1.0\""}],"types":[{"html_id":"shellyplug-prometheus-exporter/ShellyplugExporter/InvalidCredentials","path":"ShellyplugExporter/InvalidCredentials.html","kind":"class","full_name":"ShellyplugExporter::InvalidCredentials","name":"InvalidCredentials","abstract":false,"superclass":{"html_id":"shellyplug-prometheus-exporter/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"shellyplug-prometheus-exporter/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"shellyplug-prometheus-exporter/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"shellyplug-prometheus-exporter/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/error.cr","line_number":3,"url":null}],"repository_name":"shellyplug-prometheus-exporter","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"shellyplug-prometheus-exporter/ShellyplugExporter","kind":"module","full_name":"ShellyplugExporter","name":"ShellyplugExporter"}},{"html_id":"shellyplug-prometheus-exporter/ShellyplugExporter/MissingHostname","path":"ShellyplugExporter/MissingHostname.html","kind":"class","full_name":"ShellyplugExporter::MissingHostname","name":"MissingHostname","abstract":false,"superclass":{"html_id":"shellyplug-prometheus-exporter/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"shellyplug-prometheus-exporter/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"shellyplug-prometheus-exporter/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"shellyplug-prometheus-exporter/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/error.cr","line_number":2,"url":null}],"repository_name":"shellyplug-prometheus-exporter","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"shellyplug-prometheus-exporter/ShellyplugExporter","kind":"module","full_name":"ShellyplugExporter","name":"ShellyplugExporter"}},{"html_id":"shellyplug-prometheus-exporter/ShellyplugExporter/Plug","path":"ShellyplugExporter/Plug.html","kind":"class","full_name":"ShellyplugExporter::Plug","name":"Plug","abstract":false,"superclass":{"html_id":"shellyplug-prometheus-exporter/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"shellyplug-prometheus-exporter/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"shellyplug-prometheus-exporter/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/shellyplug_exporter/plug.cr","line_number":2,"url":null}],"repository_name":"shellyplug-prometheus-exporter","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"shellyplug-prometheus-exporter/ShellyplugExporter","kind":"module","full_name":"ShellyplugExporter","name":"ShellyplugExporter"},"constructors":[{"html_id":"new-class-method","name":"new","abstract":false,"location":{"filename":"src/shellyplug_exporter/plug.cr","line_number":3,"url":null},"def":{"name":"new","visibility":"Public","body":"_ = allocate\n_.initialize\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"fetch_plug_data-instance-method","name":"fetch_plug_data","abstract":false,"location":{"filename":"src/shellyplug_exporter/plug.cr","line_number":10,"url":null},"def":{"name":"fetch_plug_data","visibility":"Public","body":"if @hostname\nelse\n  raise(MissingHostname.new(\"Missing hostname environement variable\"))\nend\nclient = HTTP::Client.new(@hostname.not_nil!, @port.to_i)\nif @http_username && @http_password\n  client.basic_auth(@http_username, @http_password)\nend\nresponse = client.get(\"/meter/0\")\nif response.status_code == 401\n  raise(InvalidCredentials.new(\"Invalid credentials\"))\nend\nif response.status_code == 200\nelse\n  return JSON.parse(\"{}\")\nend\nJSON.parse(response.body)\n"}}]},{"html_id":"shellyplug-prometheus-exporter/ShellyplugExporter/Server","path":"ShellyplugExporter/Server.html","kind":"class","full_name":"ShellyplugExporter::Server","name":"Server","abstract":false,"superclass":{"html_id":"shellyplug-prometheus-exporter/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"shellyplug-prometheus-exporter/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"shellyplug-prometheus-exporter/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/shellyplug_exporter/server.cr","line_number":2,"url":null}],"repository_name":"shellyplug-prometheus-exporter","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"shellyplug-prometheus-exporter/ShellyplugExporter","kind":"module","full_name":"ShellyplugExporter","name":"ShellyplugExporter"},"class_methods":[{"html_id":"run-class-method","name":"run","abstract":false,"location":{"filename":"src/shellyplug_exporter/server.cr","line_number":3,"url":null},"def":{"name":"run","visibility":"Public","body":"Kemal.config.env = \"production\"\nKemal.config.host_binding = \"0.0.0.0\"\nKemal.config.port = 3000\nplug_instance = Plug.new\nget(\"/\") do\n  plug_data = begin\n    plug_instance.fetch_plug_data\n  rescue ex : MissingHostname | InvalidCredentials\n    puts(\"No data, #{ex} !\")\n    JSON.parse(\"{}\")\n  end\n  String.build do |io|\n    io << \"# HELP power Current power drawn in watts\\n\"\n    io << \"# TYPE power gauge\\n\"\n    io << \"power #{plug_data[\"power\"]?.try(&.as_f?) || 0}\\n\"\n    io << \"# HELP total_power Total power consumed in Watt-minute\\n\"\n    io << \"# TYPE total_power gauge\"\n    io << \"total_power #{plug_data[\"total\"]?.try(&.as_i?) || 0}\\n\"\n  end\nend\nKemal.run\n"}}]}]}]}})